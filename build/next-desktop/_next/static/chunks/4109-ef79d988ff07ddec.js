(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4109],{51466:function(e,t,i){"use strict";i.d(t,{ap:function(){return z},Pk:function(){return T},ZZ:function(){return U}});var n,s,o=i(8759),a=i(33423),r=i(99616),l=i(65244),c=i(2814),d=i(15527),u=i(14581),m=i(45967),g=i(78354),v=i(1918),_=i(27951);let h=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,[t,i]=(0,r.useState)(e),{contentRef:n}=(0,_.$Y)();return(0,r.useEffect)(()=>{let e=new ResizeObserver(e=>{let[n]=e||[];n&&n.contentRect.height!==t&&i(n.contentRect.height)});return n&&e.observe(n),()=>{e.disconnect()}},[t,n]),{contentHeight:t}};var p=i(35338),y=i(28036),b=i(51739),f=i.n(b);let x=e=>{let{title:t,children:i,restrictionsClassName:n}=e;return(0,o.jsxs)("section",{className:f().root,children:[(0,o.jsx)(v.Caption,{variant:"span",type:"text",size:"m",weight:"medium",children:t}),(0,o.jsx)(y.y,{children:(0,o.jsx)(v.Heading,{variant:"h3",children:t})}),(0,o.jsx)("div",{className:(0,p.W)(f().restrictions,n),children:i})]})},I=e=>{var t,i;let{seed:n,title:s,isStation:o}=e,{vibe:a}=(0,_.oR)(),{applySetting:c}=(0,_.Qh)({seeds:null===(t=a.meta)||void 0===t?void 0:t.seeds,pageIdForFrom:_.Rh.HOME,blockIdForFrom:_.aU.RUP_MAIN}),{formatMessage:d}=(0,l.Z)(),u=null===(i=a.meta)||void 0===i?void 0:i.seeds.includes(n),m=a.applyingSetting===n,g=(0,r.useMemo)(()=>u?"".concat(d({id:"vibe-actions.remove"})," ").concat(s):"".concat(d({id:"vibe-actions.apply"})," ").concat(s),[u,s,d]),v=(0,r.useCallback)(async()=>{a.setApplyingSetting(n),await c(n,o),a.setApplyingSetting()},[c,o,n,a]);return{isApplying:m,isSelected:u,isLoading:a.isLoading,ariaLabel:g,onClickHandler:v}};var E=i(99798),S=i.n(E);let R=(0,a.Pi)(e=>{let{item:t}=e,{isApplying:i,isSelected:n,ariaLabel:s,isLoading:a,onClickHandler:r}=I({seed:t.seed,title:t.title,isStation:!0});return(0,o.jsx)(d.Button,{radius:"xxxl",className:(0,p.W)(S().button,S().textButton,{[S().button_isSelected]:n,[S().button_isApplying]:i}),onClick:r,disabled:a,"aria-label":s,children:(0,o.jsx)(v.Caption,{variant:"span",type:"controls",size:"m",weight:"medium",className:S().title,children:t.title})})});var V=i(45656);(n=s||(s={})).DIVERSITY="diversity",n.MOOD_ENERGY="moodEnergy",n.LANGUAGE="language";let N=(0,a.Pi)(e=>{let{type:t,restrictionValue:i}=e,{isApplying:n,isSelected:a,isLoading:l,ariaLabel:c,onClickHandler:u}=I({seed:i.seed,title:i.title}),m=(0,r.useMemo)(()=>(0,o.jsx)(v.Caption,{variant:"span",type:"controls",size:"m",weight:"medium",className:S().title,children:i.title}),[i.title]);switch(t){case s.DIVERSITY:return(0,o.jsxs)(d.Button,{className:(0,p.W)(S().button,S().diversityButton,{[S().button_isSelected]:a,[S().button_isApplying]:n}),radius:"xl",onClick:u,disabled:l,"aria-label":c,children:[(0,o.jsx)(V.Image,{src:i.imageUrl,fit:"contain",width:40,height:40}),m]});case s.MOOD_ENERGY:return(0,o.jsxs)("div",{className:S().moodEnergy,children:[(0,o.jsx)(d.Button,{variant:"text",className:(0,p.W)(S().button,S().moodEnergyButton,{[S().button_isSelected]:a,[S().button_isApplying]:n}),radius:"round",withRipple:!1,onClick:u,disabled:l,"aria-label":c,children:(0,o.jsx)(V.Image,{src:i.imageUrl,fit:"contain",width:52,height:52,alt:i.title})}),m]});case s.LANGUAGE:return(0,o.jsx)(d.Button,{radius:"xxxl",className:(0,p.W)(S().button,S().textButton,{[S().button_isSelected]:a,[S().button_isApplying]:n}),onClick:u,disabled:l,"aria-label":c,children:m})}});var L=i(87004),C=i.n(L);let B={duration:300,initial:{transform:"translateX(5%)",opacity:0},open:{transform:"translateX(0)",opacity:1},close:{transform:"translateX(5%)",opacity:0}},T=(0,a.Pi)(()=>{var e,t;let{formatMessage:i}=(0,l.Z)(),{vibe:n,vibeSettings:s,settings:a}=(0,_.oR)(),{pageId:p}=(0,_.lV)(),{blockId:y}=(0,_.qY)(),{resetSettings:b}=(0,_.Qh)({seeds:null===(e=n.meta)||void 0===e?void 0:e.seeds,pageIdForFrom:p,blockIdForFrom:y}),{contentRef:f}=(0,_.$Y)(),{contentHeight:I}=h(0),[E,S]=(0,r.useState)(!1);s.loadingState===_.Gu.IDLE&&(0,r.use)(s.getData());let V=(0,r.useCallback)(()=>{S(!1)},[S]),L=a.layout===_.t8.Mobile,T=(0,r.useMemo)(()=>L?{height:"90vh"}:f?{insetInlineEnd:20,insetBlockStart:f.offsetTop+7,height:I-16}:{},[I,f,L]);return(0,r.useEffect)(()=>()=>{s.reset()},[s]),(0,o.jsxs)(m.J2,{placement:"bottom",isMobile:L,strategy:"fixed",transform:!1,positionElement:f,disableFloatingStyles:!L,open:E,onOpenChange:S,style:T,overlayClassName:C().overlay,transition:B,children:[(null===(t=n.meta)||void 0===t?void 0:t.context)?(0,o.jsx)(d.Button,{className:C().toggleSettingsButton,size:"m",radius:"round",icon:(0,o.jsx)(u.Icon,{variant:"filter",size:"xs"})}):(0,o.jsx)(d.Button,{className:C().toggleSettingsButton,size:"default",radius:"xxxl",icon:(0,o.jsx)(u.Icon,{variant:"filter",size:"xxs"}),children:(0,o.jsx)(v.Caption,{variant:"span",type:"controls",size:"m",weight:"medium",children:(0,o.jsx)(c.Z,{id:"interface-actions.configure-my-vibe"})})}),(0,o.jsx)(m.yk,{className:C().popover,children:(0,o.jsxs)("div",{className:C().root,children:[(0,o.jsxs)("div",{className:C().header,children:[(0,o.jsx)(v.Heading,{variant:"h3",size:"s",weight:"bold",children:(0,o.jsx)(c.Z,{id:"interface-actions.my-vibe-settings"})}),(0,o.jsxs)("div",{className:C().actions,children:[(0,o.jsx)(g.u,{offsetOptions:4,placement:"left",text:i({id:"interface-actions.reset-my-vibe-settings"}),children:(0,o.jsx)(d.Button,{variant:"outline",radius:"round",size:"xxxs",icon:(0,o.jsx)(u.Icon,{variant:"reset",size:"xxxs"}),onClick:b,disabled:n.isLoading||n.isMyVibe,"aria-label":i({id:"interface-actions.reset-my-vibe-settings"})})}),(0,o.jsx)(d.Button,{radius:"round",color:"secondary",size:"xxs",icon:(0,o.jsx)(u.Icon,{variant:"close",size:"xxs"}),onClick:V,"aria-label":i({id:"interface-actions.close-my-vibe-settings"})})]})]}),(0,o.jsxs)("div",{className:C().settings,children:[s.contextItems.length>0&&(0,o.jsx)(x,{title:i({id:"interface-actions.my-vibe-context-settings"}),restrictionsClassName:C().contextItems,children:s.contextItems.map(e=>(0,o.jsx)(R,{item:e},e.seed))}),s.diversity&&(0,o.jsx)(x,{title:s.diversity.title,restrictionsClassName:C().diversity,children:s.diversity.values.map(e=>(0,o.jsx)(N,{type:s.diversity.type,restrictionValue:e},e.value))}),s.moodEnergy&&(0,o.jsx)(x,{title:s.moodEnergy.title,restrictionsClassName:C().moodEnergy,children:s.moodEnergy.values.map(e=>(0,o.jsx)(N,{type:s.moodEnergy.type,restrictionValue:e},e.value))}),s.language&&(0,o.jsx)(x,{title:s.language.title,restrictionsClassName:C().contextItems,children:s.language.values.map(e=>(0,o.jsx)(N,{type:s.language.type,restrictionValue:e},e.value))})]})]})})]})});var j=i(96555);let A=e=>{let{type:t,tag:i}=e.id;return{title:e.name,seed:"".concat(t,":").concat(i),specialContext:e.specialContext,specialContextImage:e.specialContextImage}},O=e=>({value:e.value,title:e.name,seed:e.serializedSeed,imageUrl:e.imageUrl}),M=(e,t)=>{let i=[];return t.possibleValues.forEach(e=>{e.unspecified||i.push(O(e))}),{type:e,title:t.name,values:(0,j.pj)(i)}},w=j.V5.model("ContextItem",{title:j.V5.string,seed:j.V5.string,specialContext:j.V5.boolean,specialContextImage:j.V5.optional(j.V5.string,"")}),k=j.V5.model("RestrictonValue",{value:j.V5.string,title:j.V5.string,seed:j.V5.string,imageUrl:j.V5.maybe(j.V5.string)}),P=j.V5.model("Restricton",{type:j.V5.enumeration(Object.values(s)),title:j.V5.string,values:j.V5.array(k)}),z=j.V5.model("VibeSettings",{loadingState:j.V5.enumeration(Object.values(_.Gu)),contextItems:j.V5.array(w),diversity:j.V5.maybeNull(P),moodEnergy:j.V5.maybeNull(P),language:j.V5.maybeNull(P)}).actions(e=>({getData:(0,j.ls)(function*(t){let{rotorResource:i}=(0,j.dU)(e);if(e.loadingState!==_.Gu.PENDING)try{var n,o,a,r;e.loadingState=_.Gu.PENDING;let l=yield i.waveSettings(t);(null==l?void 0:null===(n=l.settingRestrictions)||void 0===n?void 0:n.diversity)&&(e.diversity=M(s.DIVERSITY,l.settingRestrictions.diversity)),(null==l?void 0:null===(o=l.settingRestrictions)||void 0===o?void 0:o.moodEnergy)&&(e.moodEnergy=M(s.MOOD_ENERGY,l.settingRestrictions.moodEnergy)),(null==l?void 0:null===(a=l.settingRestrictions)||void 0===a?void 0:a.language)&&(e.language=M(s.LANGUAGE,l.settingRestrictions.language));let c=Array.isArray(null==l?void 0:l.blocks)&&(null==l?void 0:null===(r=l.blocks)||void 0===r?void 0:r.find(e=>(null==e?void 0:e.type)==="contexts"));c&&Array.isArray(c.items)&&(e.contextItems=(0,j.pj)(c.items.map(A))),e.loadingState!==_.Gu.IDLE&&(e.loadingState=_.Gu.RESOLVE)}catch(t){console.error(t),e.loadingState!==_.Gu.IDLE&&(e.loadingState=_.Gu.REJECT)}}),reset(){e.loadingState=_.Gu.IDLE,e.contextItems=(0,j.pj)([]),e.diversity=null,e.moodEnergy=null,e.language=null}})),U=e=>!!e&&e.some(e=>{let[t]=(null==e?void 0:e.split(":"))||[];return e===_.sH||t&&_.kF.includes(t)})},54109:function(e,t,i){"use strict";i.r(t),i.d(t,{MainPage:function(){return p}});var n=i(8759),s=i(33423),o=i(99616),a=i(23463),r=i(71716),l=i(78354),c=i(1918),d=i(77404),u=i(49334),m=i(70579),g=i(27951),v=i(90779),_=i(49249),h=i.n(_);let p=(0,s.Pi)(()=>{let{main:e,user:t,experiments:i}=(0,g.oR)(),s=(0,g.bo)();e.landing.loadingState===g.Gu.IDLE&&(0,o.use)(e.landing.getSkeleton({id:a.jB.WEB_MAIN,showWizard:t.settings.showWizard},{preloadBlocks:2})),(0,o.useEffect)(()=>()=>e.landing.reset(),[e.landing]),(0,g.NO)(e.landing.loadingState===g.Gu.RESOLVE);let _=i.checkExperiment(g.pe.WebNextDisableVibe,"on"),p=(0,o.useMemo)(()=>_?{"margin-block-start":"1vh"}:{},[_]),y=(0,o.useMemo)(()=>(0,n.jsxs)(l.u,{placement:"right",offsetOptions:4,children:[(0,n.jsx)(c.Caption,{variant:"div",type:"text",size:"s",weight:"medium",className:h().beta,children:"Beta"}),(0,n.jsx)(l._v,{children:s})]}),[s]);return(0,n.jsx)(g.Lh,{pageId:g.Rh.HOME,children:(0,n.jsxs)(r.t,{className:h().root,containerClassName:h().content,children:[y,(0,n.jsxs)("div",{children:[!_&&(0,n.jsx)(g.J,{blockId:g.aU.RUP_MAIN,children:(0,n.jsx)(u.BI,{className:h().myVibe})}),(0,n.jsx)("div",{className:h().landing,style:p,children:(0,n.jsx)(d.O,{landing:e.landing,errorComponent:(0,n.jsx)(m.D,{className:h().error})})})]}),(0,n.jsx)(v.$_,{className:h().footer})]})})})},49334:function(e,t,i){"use strict";i.d(t,{BI:function(){return A},T9:function(){return P}});var n,s,o=i(8759),a=i(35338),r=i(33423),l=i(99616),c=i(27951),d=i(66936),u=i(24807),m=i(3559);let g={ACTIVE:1/80,IDLE:1/600};class v{start(){let e=window.performance.now(),t=1e3/this.fps,i=n=>{this.requestID=requestAnimationFrame(i);let s=n-e;s>=t-.1&&(e=n-s%t,this.animate(s))};this.requestID=requestAnimationFrame(i)}stop(){cancelAnimationFrame(this.requestID)}constructor(e,t){(0,u._)(this,"fps",void 0),(0,u._)(this,"animate",void 0),(0,u._)(this,"requestID",void 0),this.fps=e,this.animate=t,this.requestID=0}}(n=s||(s={})).ACTIVE_TAB="ACTIVE_TAB",n.BLOCK_VISIBILITY="BLOCK_VISIBILITY",n.MANUAL="MANUAL";class _{get width(){return .95*window.innerWidth}get height(){return .95*window.innerHeight}setupListeners(){window.addEventListener("resize",this.handleOnResize),document.addEventListener("visibilitychange",this.handleOnVisibilityChange)}create(){this.shader=new m.jyz({uniforms:{uTime:{value:0},uScreenSize:{value:new m.FM8(this.width,this.height)},uBpm:{value:120},uHue:{value:.0638},uBackgroundColor:{value:new m.Pa4(0,0,0)},uMid:{value:0},uLow:{value:1}},vertexShader:"\n    void main () {\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }\n",fragmentShader:"\n    precision highp float;\n    precision highp int;\n    \n    uniform float uTime;\n    uniform vec2 uScreenSize;\n    uniform float uBpm;\n    uniform float uHue;\n    uniform vec3 uBackgroundColor;\n    uniform float uMid;\n    uniform float uLow;\n    \n    const float MAX_TEMPO = 174.0;\n    const float YZ_ROTATION_MULTIPLIER = 1.0;\n    const float XZ_ROTATION_MULTIPLIER = 0.7;\n    const float XY_ROTATION_MULTIPLIER = 0.5;\n    const float WAVE_MOVEMENT_MULTIPLIER = 1.5;\n    const float FREQUENCY = 1.2;\n    vec2 vReactionPoint = vec2(0.0, 0.0);\n    vec3 vReactionColor =  vec3(1.0, 1.0, 1.0);\n    const float REACTION_POINT_SIZE =  0.2;\n    const float MIN_FREQUENCY =  0.5;\n    const float FREQUENCY_MID_MULTIPLIER =  0.5;\n    const float vReaction =  .0;\n    const float FREQUENCY_REACTION_MULTIPLIER =  1.5;\n    const float SCENE_ROTATION =  3.1451 * 1.75;\n    const float SCENE_SCALE =  1.0;\n    const float vReactionScale =  0.8;\n    const float DISTANCE =  3.5;\n    const int PASS_COUNT =  4;\n    const float COLOR_MULTIPLIER =  7.0;\n    \n    float bpm(float b) {\n        return b / MAX_TEMPO;\n    }\n    \n    vec3 hsl2rgb(vec3 c) {\n        return c.z + c.y * (c.z + c.y * ((c.z + c.y * (clamp( abs(mod(c.x*6.0+vec3(0.0,4.0,2.0),6.0)-3.0)-1.0, 0.0, 1.0 )-0.5)*(1.0-abs(2.0*c.z-1.0)))-0.5)*(1.0-abs(2.0*c.z-1.0))-0.5)*(1.0-abs(2.0*c.z-1.0));\n    }\n    \n    mat2 mRotate(float angle) {\n        float c = cos(angle);\n        float s = sin(angle);\n        \n        return mat2(c, -s, s, c);\n    }\n    float waves(vec3 point, float freq) {\n        point.yz *= mRotate(uTime * YZ_ROTATION_MULTIPLIER);\n        point.xz *= mRotate(uTime * XZ_ROTATION_MULTIPLIER);\n        point.xy *= mRotate(uTime * XY_ROTATION_MULTIPLIER);\n\n        vec3 q = point * (1.0 + bpm(uBpm)) + uTime * WAVE_MOVEMENT_MULTIPLIER;\n        float centeredCircle = length(point);\n        float centerCut = log(length(point) - 1.0);\n        float waves = freq * sin(FREQUENCY * q.x - sin(FREQUENCY * q.y + sin(q.z * FREQUENCY))) - 1.0;\n        \n        return centeredCircle * centerCut + waves;\n    }\n    void main(){\n        float TAIL_INTENSITY =  3.0 + 1.0 * uLow;\n        vec2 uvTrue = gl_FragCoord.xy / uScreenSize;\n        vec2 uv = -1.0 + 2.0 * uvTrue;\n\n        float minSide = min(uScreenSize.x, uScreenSize.y);\n        vec2 minSquare = vec2(minSide, minSide);\n        vec2 aspectSides = uScreenSize / minSide;\n        uv *= aspectSides;\n\n        vec2 reactPoint = vReactionPoint * aspectSides;\n        float reactIntensity = clamp(length(uv - reactPoint) / 2.0 / REACTION_POINT_SIZE, 0.0, 1.0);\n\n        float freq = MIN_FREQUENCY + uMid * FREQUENCY_MID_MULTIPLIER;\n        freq = mix(freq + vReaction * FREQUENCY_REACTION_MULTIPLIER, freq, reactIntensity);\n\n        uv *= mRotate(SCENE_ROTATION);\n        uv *= 1.0 / SCENE_SCALE;\n        uv /= vReactionScale;\n\n        float opacity = 0.0;\n        float d = DISTANCE;\n        for(int i = 0; i < PASS_COUNT; i++) {\n            vec3 p = vec3(0, 0, 5.) + vec3(uv, -1.0) * d;\n            float result = waves(p, freq);\n            float f = result - waves(p + 0.03, freq);\n            float l = f * (COLOR_MULTIPLIER + vReaction * 2.0);\n            opacity = opacity * l + smoothstep(TAIL_INTENSITY, 1.0, result) * l;\n            d += min(result, 1.0);\n        }\n\n        vec3 gradColor = mix(hsl2rgb(vec3(uHue, 1.0, 0.5)), hsl2rgb(vec3(uHue + 0.06, 1.0, 0.5)), uvTrue.y);\n        vec3 reactedColor = mix(gradColor, vReactionColor, vReaction * (1.0 - reactIntensity));\n        vec3 color = mix(uBackgroundColor, reactedColor, clamp(opacity, 0.0, 1.0));\n\n        float average_color = (color.x + color.y + color.z) / 3.0;\n        float result_opacity = min(1.0, (average_color - 0.0) * 5.0);\n        gl_FragColor = vec4(color, result_opacity);\n    }\n"});let e=new m._12(2,2),t=new m.Kj0(e,this.shader);t.position.z=-1,this.scene.add(t)}render(){var e,t,i;(null===(t=this.shader)||void 0===t?void 0:null===(e=t.uniforms)||void 0===e?void 0:e.uTime)&&(this.shader.uniforms.uTime.value+=this.speed),null===(i=this.renderer)||void 0===i||i.render(this.scene,this.camera)}handleOnResize(){var e,t,i;null===(e=this.renderer)||void 0===e||e.setSize(this.width,this.height),this.camera.updateProjectionMatrix(),(null===(i=this.shader)||void 0===i?void 0:null===(t=i.uniforms)||void 0===t?void 0:t.uScreenSize)&&(this.shader.uniforms.uScreenSize.value.x=this.width,this.shader.uniforms.uScreenSize.value.y=this.height)}handleOnVisibilityChange(){document.hidden?this.disableRender(s.ACTIVE_TAB):this.enableRender(s.ACTIVE_TAB)}updateRenderingFlag(){let e=Object.values(this.renderState).every(e=>e);e?this.ticker.start():this.ticker.stop()}applyTheme(e){var t,i;let n=e?0:.9607;(null===(i=this.shader)||void 0===i?void 0:null===(t=i.uniforms)||void 0===t?void 0:t.uBackgroundColor)&&(this.shader.uniforms.uBackgroundColor.value=new m.Pa4(n,n,n))}applySettings(e,t,i){var n,s;e&&(null===(n=this.shader)||void 0===n?void 0:n.uniforms.uBpm)&&(this.shader.uniforms.uBpm.value=e),t&&(null===(s=this.shader)||void 0===s?void 0:s.uniforms.uHue)&&(this.shader.uniforms.uHue.value=t),this.speed=null!=i?i:g.IDLE}playAnimation(e,t,i){this.applySettings(e,t,null!=i?i:g.ACTIVE)}idleAnimation(){this.speed=g.IDLE}enableRender(e){this.renderState[e]=!0,this.updateRenderingFlag()}disableRender(e){this.renderState[e]=!1,this.updateRenderingFlag()}destroy(){this.handleOnResize&&window.removeEventListener("resize",this.handleOnResize),this.handleOnVisibilityChange&&document.removeEventListener("visibilitychange",this.handleOnVisibilityChange)}constructor(e){(0,u._)(this,"canvas",void 0),(0,u._)(this,"ticker",void 0),(0,u._)(this,"scene",void 0),(0,u._)(this,"camera",void 0),(0,u._)(this,"shader",void 0),(0,u._)(this,"renderer",void 0),(0,u._)(this,"speed",void 0),(0,u._)(this,"renderState",void 0),this.canvas=e,this.scene=new m.xsS,this.camera=new m.iKG,this.shader=null,this.renderer=null,this.speed=g.IDLE,this.renderState={[s.ACTIVE_TAB]:!0,[s.BLOCK_VISIBILITY]:!0,[s.MANUAL]:!0},this.renderer=new m.CP7({canvas:e,antialias:!1,alpha:!1}),this.camera.position.set(0,0,10),this.handleOnResize=this.handleOnResize.bind(this),this.handleOnVisibilityChange=this.handleOnVisibilityChange.bind(this),this.ticker=new v(25,this.render.bind(this)),this.create(),this.handleOnResize(),this.setupListeners()}}var h=i(85036),p=i.n(h);let y=(0,r.Pi)(e=>{let{isPlaying:t,className:i}=e,n=(0,l.useRef)(null),a=(0,l.useRef)(null),r=(0,d.S1)(n),{theme:u,colorScheme:m}=(0,c.$Y)(),{sonataState:g}=(0,c.oR)();return(0,l.useEffect)(()=>{if(n.current){var e,t,i;let{bpm:s,hue:o,energy:r}=(null===(e=g.entityMeta)||void 0===e?void 0:e.trackParametrs)||{},l=new _(n.current);return a.current=l,null===(t=a.current)||void 0===t||t.applySettings(s,o,r),null===(i=n.current)||void 0===i||i.classList.add(p().root_visible),()=>{l.destroy()}}},[]),(0,l.useEffect)(()=>{if(a.current){let e=u===c.Q2.System?m===c.Q2.Dark:u===c.Q2.Dark;a.current.applyTheme(e)}},[u,m]),(0,l.useEffect)(()=>{if(a.current){var e,i,n;let{bpm:s,hue:o,energy:r}=(null===(e=g.entityMeta)||void 0===e?void 0:e.trackParametrs)||{};t?null===(i=a.current)||void 0===i||i.playAnimation(s,o,r):null===(n=a.current)||void 0===n||n.idleAnimation()}},[t,g.entityMeta]),(0,l.useEffect)(()=>{if(a.current){var e,t;r?null===(e=a.current)||void 0===e||e.enableRender(s.BLOCK_VISIBILITY):null===(t=a.current)||void 0===t||t.disableRender(s.BLOCK_VISIBILITY)}},[r]),(0,o.jsx)("canvas",{className:i,ref:n})});var b=i(50218),f=i.n(b),x=i(2814),I=i(15527),E=i(14581),S=i(12761),R=i.n(S);let V=(0,r.Pi)(e=>{let{isPlaying:t,onClick:i,className:n}=e,{vibe:s}=(0,c.oR)(),r=(0,l.useMemo)(()=>t?"pauseVibe":"playVibe",[t]),d=(0,l.useCallback)(e=>{null==i||i(),e.stopPropagation(),e.preventDefault()},[i]);return(0,o.jsx)(I.Button,{className:(0,a.W)(R().root,{[R().root_isLoading]:s.isLoading},n),withRipple:!1,withHover:!1,onClick:d,variant:"text",icon:(0,o.jsx)(E.Icon,{size:"s",className:(0,a.W)(R().icon,R()["icon_".concat(r)]),variant:r}),disabled:s.isLoading,children:(0,o.jsx)(x.Z,{id:"entity-names.my-vibe"})})});var N=i(65244),L=i(1918),C=i(51466),B=i(78995),T=i.n(B);let j=(0,r.Pi)(e=>{var t;let{context:i,onResetClick:n,className:s}=e,{vibe:r}=(0,c.oR)(),{formatMessage:d}=(0,N.Z)();return(0,o.jsxs)("div",{className:(0,a.W)(T().root,s),children:[(0,o.jsx)(l.Suspense,{children:(0,C.ZZ)(null===(t=r.meta)||void 0===t?void 0:t.seeds)&&(0,o.jsx)(C.Pk,{})}),i&&(0,o.jsxs)("div",{className:(0,a.W)(T().context),children:[(0,o.jsx)(L.Caption,{variant:"span",type:"controls",size:"m",weight:"medium",lineClamp:1,children:i}),(0,o.jsx)(I.Button,{className:T().resetButton,variant:"text",radius:"round",withRipple:!1,icon:(0,o.jsx)(E.Icon,{variant:"close",size:"xxs"}),onClick:n,"aria-label":"".concat(d({id:"vibe-actions.reset-settings"})," ").concat(i)})]})]})}),A=(0,r.Pi)(e=>{var t,i;let{className:n}=e,{vibe:s,experiments:r}=(0,c.oR)(),{pageId:d}=(0,c.lV)(),{blockId:u}=(0,c.qY)(),{isVibeContext:m,isPlaying:g,togglePlay:v,resetSettings:_}=(0,c.Qh)({seeds:null===(t=s.meta)||void 0===t?void 0:t.seeds,pageIdForFrom:d,blockIdForFrom:u}),h=r.checkExperiment(c.pe.WebNextDisableVibeSettings,"on");s.getLastLoadingState===c.Gu.IDLE&&(0,l.use)(s.getLastVibe());let p=(0,l.useCallback)(()=>{m?_():s.vibeResetLoadingState!==c.Gu.PENDING&&s.vibeReset()},[m,s,_]);return(0,l.useEffect)(()=>()=>{s.reset()},[s]),(0,o.jsxs)("div",{className:(0,a.W)(f().root,n),children:[(0,o.jsx)(y,{isPlaying:g,className:f().animation}),(0,o.jsxs)("div",{className:f().controls,children:[(0,o.jsx)(V,{isPlaying:g,onClick:v}),!h&&(0,o.jsx)(j,{className:f().settingsButton,context:null===(i=s.meta)||void 0===i?void 0:i.context,onResetClick:p})]})]})});var O=i(96555),M=i(23463);let w=O.V5.model("Vibe",{title:O.V5.string,stationId:O.V5.string,seeds:O.V5.array(O.V5.string),idForFrom:O.V5.maybe(O.V5.string),imageUrl:O.V5.maybe(O.V5.string),animationUrl:O.V5.maybe(O.V5.string),colors:O.V5.maybe(O.V5.model({average:O.V5.maybe(O.V5.string),waveText:O.V5.maybe(O.V5.string)}))}).views(e=>({get context(){if(e.seeds&&(e.stationId!==c.sH||e.seeds.length>1))return e.title;return null}})),k=e=>(0,O.pj)({title:e.name,seeds:e.seeds,stationId:e.stationId,idForFrom:e.idForFrom}),P=O.V5.model("VibeActions",{meta:O.V5.maybeNull(w),applyingSetting:O.V5.maybeNull(O.V5.string),isLoading:O.V5.boolean,getLastLoadingState:O.V5.enumeration(Object.values(c.Gu)),vibeResetLoadingState:O.V5.enumeration(Object.values(c.Gu))}).actions(e=>({getLastVibe:(0,O.ls)(function*(){let{rotorResource:t}=(0,O.dU)(e);if(e.getLastLoadingState!==c.Gu.PENDING)try{e.getLastLoadingState=c.Gu.PENDING;let i=yield t.waveLast();e.meta=k(i),e.getLastLoadingState=c.Gu.RESOLVE}catch(t){console.error(t),e.getLastLoadingState=c.Gu.REJECT}}),vibeReset:(0,O.ls)(function*(){let{rotorResource:t}=(0,O.dU)(e);if(e.vibeResetLoadingState!==c.Gu.PENDING)try{e.vibeResetLoadingState=c.Gu.PENDING;let i=yield t.waveLastReset();i===M.NE.OK&&(e.meta=k({name:"",seeds:[c.sH],stationId:c.sH,idForFrom:c.sH})),e.vibeResetLoadingState=c.Gu.RESOLVE}catch(t){console.error(t),e.vibeResetLoadingState=c.Gu.REJECT}}),setApplyingSetting(t){t?e.applyingSetting=(0,O.pj)(t):e.applyingSetting=null},setIsLoading(t){e.isLoading=t},setVibe(t){e.meta=k(t)},reset(){e.meta=null,e.vibeResetLoadingState=c.Gu.IDLE,e.getLastLoadingState=c.Gu.IDLE}})).views(e=>({get isMyVibe(){return e.meta&&1===e.meta.seeds.length&&e.meta.seeds[0]===c.sH}}))},51739:function(e){e.exports={root:"RestrictionBlock_root__P_g9o",restrictions:"RestrictionBlock_restrictions__BhR_r"}},99798:function(e){e.exports={button:"RestrictionButton_button__eLMkU",button_isSelected:"RestrictionButton_button_isSelected__QVkqB",button_isApplying:"RestrictionButton_button_isApplying__BcBOC","applying-setting":"RestrictionButton_applying-setting__utqyc",diversityButton:"RestrictionButton_diversityButton__uclSi",moodEnergy:"RestrictionButton_moodEnergy__q_I4y",moodEnergyButton:"RestrictionButton_moodEnergyButton__yKkaS",textButton:"RestrictionButton_textButton__HC_AE",title:"RestrictionButton_title__UZn0O"}},87004:function(e){e.exports={root:"VibeSettingsBlock_root__t8Hp_",popover:"VibeSettingsBlock_popover__ogu17",overlay:"VibeSettingsBlock_overlay__5jAS5",toggleSettingsButton:"VibeSettingsBlock_toggleSettingsButton__g9rTZ",header:"VibeSettingsBlock_header__Ww2RA",actions:"VibeSettingsBlock_actions__JEc14",settings:"VibeSettingsBlock_settings__0Kluc",diversity:"VibeSettingsBlock_diversity__tU1OY",moodEnergy:"VibeSettingsBlock_moodEnergy__OJ0wF",contextItems:"VibeSettingsBlock_contextItems__kTvUX"}},49249:function(e){e.exports={content:"Main_content__JQfzp",root:"Main_root__OWAd_",container:"Main_container__Vci64",myVibe:"Main_myVibe__nHDGq",landing:"Main_landing__eYJ5U",beta:"Main_beta__oVI0k",footer:"Main_footer__f_lwB",error:"Main_error__j8Viy",important:"Main_important__HrwU2"}},50218:function(e){e.exports={root:"MyVibe_root__WJqPf",animation:"MyVibe_animation__NQ_Ye",controls:"MyVibe_controls__AYcSn",settingsButton:"MyVibe_settingsButton___dVFc"}},12761:function(e){e.exports={root:"PlayButton_root__kLG6U",root_isLoading:"PlayButton_root_isLoading__QpHwQ","applying-setting":"PlayButton_applying-setting__Fj72R",icon:"PlayButton_icon__ci_kr",icon_pauseVibe:"PlayButton_icon_pauseVibe__QKC_2",icon_playVibe:"PlayButton_icon_playVibe__K_yQ7"}},78995:function(e){e.exports={root:"VibeContext_root__P1pRz",context:"VibeContext_context__wgtUF",resetButton:"VibeContext_resetButton__fiW0a"}},85036:function(e){e.exports={root_visible:"MyVibeAnimation_root_visible__1spBD","fade-in":"MyVibeAnimation_fade-in__uwtqz"}}}]);
//# sourceMappingURL=4109-ef79d988ff07ddec.js.map